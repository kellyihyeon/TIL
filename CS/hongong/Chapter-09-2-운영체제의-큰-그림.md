## 학습 키워드

- `커널` `이중 모드` `시스템 호출` `운영체제 서비스`
- 응용 프로그램이 어떻게 운영체제의 도움을 받으며 실행 되는가?
- 운영체제가 응용 프로그램에 어떤 서비스를 제공하는가?

---

# 운영체제의 심장, 커널(kernel)

- 운영체제의 핵심 서비스
    - 자원에 접근하고 조작하는 기능
    - 프로그램이 올바르고 안전하게 실행되게 하는 기능
- 운영체제의 핵심 서비스를 담당하는 부분을 커널이라고 한다.
- 운영체제가 설치된 모든 기기에는 커널이 있다.

# 이중 모드와 시스템 호출

- 운영체제는 응용 프로그램들이 자원에 접근하려고 할 때 오직 자신을 통해서만 접근하도록하여 자원을 보호함
- 응용 프로그램의 요청을 받은 운영체제는 응용 프로그램 대신 자원에 접근하여 요청한 작업을 수행함

![](/CS/hongong/img/운영체제_중개자.png)

## 이중 모드(dual mode)

- 운영 체제의 문지기 역할은 이중 모드로써 구현된다.
- **이중 모드**란 CPU가 명령어를 실행하는 모드를 크게 **사용자 모드**와 **커널 모드**로 구분하는 방식이다.
- 💡 CPU가 사용자 모드로 실행 중인지, 커널 모드로 실행 중인지는 플래그 레지스터 속 슈퍼바이저 플래그를 보면 알 수 있다.

### 사용자 모드(user mode)

- 운영체제 서비스를 제공받을 수 없는 실행 모드 = 커널 영역의 코드를 실행할 수 없는 모드
- 일반적인 응용 프로그램은 기본적으로 사용자 모드로 실행됨
- 사용자 모드로 실행 중인 CPU는 입출력 명령어와 같이 하드웨어 자원에 접근하는 명령어를 실행할 수 없음

### 커널 모드(kernel)

- 운영체제 서비스를 제공받을 수 있는 실행 모드 = 커널 영역의 코드를 실행할 수 있는 모드
- CPU가 커널 모드로 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있음

## 시스템 호출(system call)

- 사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공받으려면 운영체제에 요청을 보내 커널 모드로 전환되어야 한다.
- 이때 운영체제 서비스를 제공받기 위한 요청을 **시스템 호출**이라고 한다.

![](/CS/hongong/img/시스템호출.png)

- 시스템 호출은 일종의 소프트웨어적인 인터럽트이다. 인터럽트는 인터럽트를 발생시키는 특정 명령어에 의해 발생하기도 하는데, 이를 **소프트웨어 인터럽트**라고 한다.

### CPU가 시스템 호출을 처리하는 순서

⓵ 시스템 호출을 발생시키는 명령어가 실행되면 CPU는 지금까지의 작업을 백업하고

⓶ 커널 영역 내에 시스템 호출을 수행하는 코드를 실행한 뒤

⓷ 다시 기존에 실행하던 응용 프로그램으로 복귀하여 실행을 계속해 나감

![](/CS/hongong/img/시스템호출_처리_순서.png)

*🤔 한 응용 프로그램이 하드 디스크에 데이터를 저장하려 한다면?*

- 응용 프로그램은 하드 디스크에 데이터를 저장하는 시스템 호출을 발생시켜 커널 모드로 전환함
- 운영체제 내의 ‘하드 디스크에 데이터를 저장하는 코드’를 실행하여 하드 디스크에 접근할 수 있음
- 하드 디스크에 접근이 끝나면 다시 사용자 모드로 복귀하여 실행을 계속해 나감

![](/CS/hongong/img/시스템호출_흐름.png)

# 운영체제의 핵심 서비스

## 프로세스 관리

- 실행 중인 프로그램을 **프로세스**라고 한다.
- 일반적으로 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있기 때문에 CPU는 프로세스들을 조금씩 번갈아 가며 실행함
- 각 프로세스는 상태, 사용하고자 하는 자원이 다양함

![](/CS/hongong/img/프로세스_관리.png)

- 운영체제는 다양한 프로세스를 일목요연하게 관리하고 실행할 수 있어야 한다.
    - 자세한 내용은 Chapter 10장 프로세스와 스레드 를 참고하세요!
- 여러 프로세스가 동시에 실행되는 환경에서는 ‘프로세스 동기화’가 필수적이고, 프로세스의 ‘교착 상태’를 해결해야 함
    - 자세한 내용은 Chapter 12장 프로세스 동기화, Chapter 13장 교착 상태 를 참고하세요!

## 자원 접근 및 할당

### CPU

- 일반적으로 메모리에는 여러 프로세스가 적재되고, 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있다.
- 이에 운영체제는 프로세스들에 공정하게 CPU를 할당하기 위해 어떤 프로세스부터 CPU를 이용하게 할 것인지, 얼마나 오래 CPU를 이용하게 할지를 결정할 수 있어야 한다. 이를 **CPU 스케줄링**이라고 한다.
    - 자세한 내용은 Chapter 11장 **CPU 스케줄링** 을 참고하세요!

### 메모리

- 운영체제는 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지를 결정해야 한다.
- 메모리가 이미 꽉 차 있어 반드시 실행해야 할 프로세스를 적재할 공간이 없는 경우도 있고, 메모리에 공간이 남았는데도 불구하고 프로세스를 적재하지 못하는 상황도 발생한다.
    - 운영체제가 프로세스에게 어떻게 메모리를 할당하는지, 그리고 메모리가 부족할 경우 이를 어떻게 극복하는지는 Chapter 14장 **가상 메모리** 를 참고하세요!

### 입출력장치

- **인터럽트 서비스 루틴**은 운영체제가 제공하는 기능으로 커널 영역에 있다.
- 입출력장치가 CPU에 하드웨어 인터럽트 요청 신호를 보내면 CPU는 하던 일을 잠시 백업한 뒤 커널 영역에 있는 **인터럽트 서비스 루틴**을 실행한다.
- 운영체제는 인터럽트 서비스 루틴을 제공함으로써 입출력작업을 수행한다.

## 파일 시스템 관리

- 우리가 컴퓨터를 사용할 때 여러 파일을 열고, 생성하고, 삭제한다. 그리고 이 파일들을 한데 묶어 디렉터리로 관리한다. 이런 **파일 시스템**도 운영체제가 지원하는 핵심 서비스이다.
    - 운영체제가 보조기억장치 속 데이터를 어떻게 파일과 디렉터리로 관리하는지 자세한 내용은 Chapter 15장 **파일 시스템** 을 참고하세요!