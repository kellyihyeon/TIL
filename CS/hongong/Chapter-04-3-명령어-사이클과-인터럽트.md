## 학습 키워드

- `명령어 사이클` `인터럽트` `예외` `하드웨어 인터럽트` `인터럽트 서비스 루틴`

---

# 명령어 사이클

- CPU는 명령어들을 하나씩 실행한다. 이때 프로그램 속 각각의 명령어들은 일정한 주기가 반복되며 실행되는데, 이 주기를 명령어 사이클이라고 한다.
- 하나의 명령어를 처리하는 정형화된 흐름

### 명령어 사이클 과정

1. 인출 사이클 (fetch cycle)
    - 메모리에 있는 명령어를 CPU로 가지고 오는 단계
2. 실행 사이클 (excution cycle)
    - CPU로 가져온 명령어를 실행하는 단계
    - 예: 제어 장치가 명령어 레지스터에 담긴 값을 해석하고 제어 신호를 발생시키는 단계
3. 간접 사이클 (indirect cycle)
    - 명령어를 인출하여 CPU로 가져왔다 하더라도 곧바로 실행할 수 없는 경우에 사용하는 단계
    - 예: 간접 주소 지정 방식은 오퍼랜드 필드에 유효 주소의 주소를 명시하기 때문에 바로 실행 사이클로 돌입할 수 없다. 명령어를 실행하기 위해서 메모리 접근을 한 번 더 해야 한다.
    
    ![](/CS/hongong/img/명령어사이클_간접사이클.png)
    

# 인터럽트

- CPU가 수행 중인 작업은 방해를 받아 중단될 수 있는데, 이렇게 CPU의 작업을 방해하는 신호를 인터럽트 라고 한다.
- 인터럽트는 CPU의 정상적인 작업을 방해하는 신호

## 인터럽트의 종류

### 동기 인터럽트 (synchronous interrupts)

- CPU에 의해 발생하는 인터럽트
- CPU가 명령어들을 수행하다가 예상치 못한 상황에 마주쳤을 때 발생하는 인터럽트
- **예외**(exception)라고 부른다.

### 비동기 인터럽트

- 주로 입출력장치에 의해 발생하는 인터럽트
- 입출력장치에 의한 비동기 인터럽트는 알림 역할을 한다.
- 예시
    - 프린터에 입출력 작업을 부탁하면 작업을 끝낸 프린터가 CPU에 완료 알림(인터럽트)을 보냄
- 일반적으로 비동기 인터럽트를 인터럽트라고 칭한다. (*용어 혼동 방지를 위해 **하드웨어 인터럽트** 라는 용어를 사용해서 설명함)

### 하드웨어 인터럽트

- CPU는 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 이런 알림과 같은 하드웨어 인터럽트를 사용
- 하드웨어 인터럽트를 사용하지 않는다면?
    - CPU가 프린터에 출력을 명령했을 때 CPU는 프린터가 언제 프린트를 끝낼지 모르기 때문에 주기적으로 프린터의 완료 여부를 확인해야 함
    - 하드웨어 인터럽트를 사용함으로써 CPU는 프린터로부터 프린트 완료 인터럽트를 받을 때까지 다른 작업을 처리할 수 있음

### 하드웨어 인터럽트 처리 순서

1. 입출력장치는 CPU에 **인터럽트 요청 신호**를 보냄
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전에 항상 인터럽트 여부를 확인함
3. CPU는 인터럽트 요청을 확인하고 **인터럽트 플래그**를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인함
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업함
5. CPU는 **인터럽트 벡터**를 참조하여 **인터럽트 서비스 루틴**을 실행함
6. 인터럽트 서비스 루틴 실행이 끝나면 4에서 백업해 둔 작업을 복구하여 실행을 재개함

- 인터럽트 요청 신호
    - 인터럽트는 CPU의 정상적인 실행 흐름을 끊는 것이기 때문에 다른 누군가가 인터럽트 하기 전에 “지금 끼어들어도 되나요?” 하고 CPU에 물어봐야 함
- 인터럽트 플래그
    - 하드웨어 인터럽트를 받아들일지 무시할지를 결정하는 플래그
    - 인터럽트의 요청을 수용하려면 플래그 레지스터의 인터럽트 플래그가 활성화되어 있어야 함
    - 인터럽트 플래그로 막을 수 있는 인터럽트와 막을 수 없는 인터럽트가 있음
- 인터럽트 서비스 루틴
    - CPU가 인터럽트 요청을 받아들이기로 했을 때 인터럽트를 처리하기 위한 프로그램
    - **인터럽트 핸들러** 라고도 부름
    - 어떤 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보로 이루어진 프로그램
        - ‘마우스가 어떤 인터럽트 요청을 보냈을 때는 어떻게 작동한다.’
- 인터럽트 벡터
    - 인터럽트 서비스 루틴을 식별하기 위한 정보
    - CPU는 수많은 인터럽트 서비스 루틴을 구분하기 위해 인터럽트 벡터를 사용
    - CPU가 인터럽트 서비스 루틴을 실행하려면 인터럽트 서비스 루틴의 시작 주소를 알아야 하는데, 이는 인터럽트 벡터를 통해 알 수 있음
    

### 인터럽트가 발생했을 때

CPU의 프로그램 카운터에 1500이 저장되어 있는데 하드웨어 인터럽트가 발생하여 10번지에 있는 인터럽트 서비스 루틴을 실행해야 한다면?

![](/CS/hongong/img/인터럽트_발생_전.png)

- 수행하고 있던 일은 인터럽트 서비스 루틴이 끝나면 되돌아와서 마저 수행을 해야 하기 때문에 작업 내역들을 어딘가에는 백업을 해둬야 한다.
- 그러므로 현재 프로그램을 재개하기 위해 필요한 모든 내용을 스택에 백업한다.

![](/CS/hongong/img/인터럽트_발생_후.png)

# 명령어 사이클 구성

![](/CS/hongong/img/명령어_사이클_최종.png)